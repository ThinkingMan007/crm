<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>优惠券java-doc</title>
</head>
<body>

<a  name="flowchart">
<fieldset>
<legend>优惠券业务流程图</legend>
<img alt="" src="doc-files/优惠券流程图.jpg">
</fieldset>
</a>
<a  name="customerMode">
<fieldset>
<legend>优惠券概念模型</legend>
<img alt="" src="doc-files/类关系图.jpg">
</fieldset>
</a>
<a  name="customerClass">
<fieldset>
<legend>优惠券ER图</legend>
<img src="doc-files/优惠券ER图.jpg" alt="" width="682" height="595" border="1">
</fieldset>
</a>
<a  name="DevelopPlanMgr">
<fieldset>
<legend>优惠券规则设置</legend>
<table border="1">
<tr><td colspan="2" align="center">营销计划新增：</td><td></td></tr>
<tr><td>RULE-A1</td><td>
<b>营销计划新增：</b><br>
1）在营销计划新增页面，保存或启用营销计划成功时，系统按规则自动生成营销计划编码；<br>
2）营销计划编码不可修改，不可重复；<br>
3）营销计划编码生成规则：<br>
  MP+年月日+3位顺序码。年月日为8位数字的营销计划初始创建日期（即打开营销计划新增的日期）；<br>
  顺序码由3位数字构成，每天均从001开始，每添加一个营销计划，顺序码增加1。<br>
4）营销计划名称为手动填写，名称可重复；<br>
</td><td><a href="#saveMarketPlan">营销计划新增序列图设计</a></td></tr>
<tr><td>RULE-A2</td><td>
<b>选择发券类型：</b><br>
1）优惠券类型包括：自动返券、手动发券；<br>
2）优惠券类型，默认为自动返券；<br>
3）选择优惠券类型为自动返券时，下方标签自动切换到自动返券界面；<br>
4）选择优惠类型为手动发券时，下方标签自动切换到手动发券界面；<br>
5）手动返券与自动返券的标签页，标签不可点击切换；<br>
6）切换优惠券类型时，如果当前优惠券类型中信息不为空，则提示：“切换优惠券类型，<br>
   当前优惠券生成规则信息将会丢失，确认切换吗？”，点击“是”则切换标签，点击“否”则不切换标签；<br>
7）切换优惠券类型时，优惠券生成规则中的信息会被重置成初始状态，<br>
   优惠券使用条件、短信内容、优惠券描述等信息，则不受影响，不会改变；<br>
</td><td></td></tr>
<tr><td>RULE-A3</td><td>
<b>手动发券规则：</b><br>
1）手动发券规则：优惠券金额：优惠券最多可以冲减的金额；<br>
2）发放数量：当前营销计划累计可生成的优惠券数；<br>
  a. 当该营销计划启用时，则根据发放数量自动生成相应数量的优惠券；<br>
  b. 发放数量必须为整数，在1-100000之间；
</td><td></td></tr>

<tr><td>RULE-A4</td><td>
<b>自动返券规则：(由CRM实现规则制定，由报表筛选数据)</b><br>
1) 返券期限：运单自动生成优惠券的时间段，时间精确到分钟；<br>
  a. 返券期限以运单签收时间为准，在返券期限内签收的运单，符合其它返券规则即可获得返券；<br>
  b. 运单反签收后，再次签收时，系统不再发放优惠券；<br>
  c. 返券开始日期必须不早于当前日期，返券结束日期不早于返券开始日期；<br>
  d. 返券期限为必填项。<br>
2)	线路区域要求：下拉选项包括<空>、走货线路、发货区域、到达区域。<br>
  a. 选择<空>，表示线路区域不作为生成优惠券的限制条件。<br>
  b. 选择走货线路，表示生成优惠券的线路要求，可批量添加。<br>
	其中，出发城市和到达城市按运作线路进行选择。例如，运单交接的第一个专线在上海，即认为出发城市为上海。<br>
  c. 选择发货区域，则树状选择框内选中的营业部所开的运单（含集中开单组为该部门所开的运单），<br>
	满足其它限制条件时可获得优惠券，其余部门开的运单不能获得该规则下的优惠券；<br>
	组织架构为经营部门，可选层级包括：事业部、大区、小区、营业部。<br>
  d. 选择到达区域，则运单到达部门为树状选择框内选中的部门（含营业部、派送部），<br>
	满足其它限制条件时可获得优惠券，其余到达部门不能获得该规则下的优惠券；<br>
	组织架构为经营部门，可选层级包括：事业部、大区、小区、营业部（含派送部）。<br>
【注：在系统性能可以支撑的情况下，期望可以同时限制发货区域与到达区域！】<br>
3)	产品类型：数据来源为FOSS基础数据中已激活的“产品条目”，可多选。<br>
4)	订单来源：即FOSS导入开单的订单类型，可多选。<br>
5)	客户等级：选项包括：普通客户、黄金客户、铂金客户、钻石客户，可多选。<br>
	若不选，则表示客户等级不作为判断优惠券生成的条件。设置客户等级时，则默认该优惠券仅限固定客户使用。<br>
6)	客户行业：数据来源为CRM字典表“行业”中的信息，可多选。<br>
	若不选，则表示客户行业不作为判断优惠券生成的条件。设置客户行业时，则默认该优惠券仅限固定客户使用。<br>
7)	返券金额：参见RULE-A11<br>
8)	运单只有满足以上7类优惠券的返券要求，并且发货人有手机号码，系统才会自动返券。
</td><td><a href="#autoCoupon">自动返券序列图设计</a></td></tr>

<tr><td>RULE-A5</td><td>
<b>优惠券使用条件：</b><br>
1)	金额要求：<br>
	a. 金额要求有两种类型：严格抵扣模式、分级抵扣模式，两种类型必须二选一；<br>
	b. 下拉可选金额包括：运费、开单金额； <br>
	c. 当运单包含折扣时，以上金额均以折扣后的最终金额为准；<br>
2)	金额要求——严格抵扣模式：<br>
	a. 运单的金额（运费/开单金额）达到设置的金额才可使用优惠券；<br>
	b. 优惠券抵扣的金额与优惠券的面值金额（即返券金额）相等；
3)	金额要求——分级抵扣模式：<br>
	a. 运单的金额（运费/开单金额）满足设置的层级金额，即可使用优惠券；<br>
	b. 优惠券抵扣的金额并可叠加，但是最终抵扣的总金额不超过优惠券面值。<br>
	若优惠券面值为A，金额要求为每满B元抵扣C元，现运单金额为D，则优惠券可抵扣金额=min{A,└D/C┘*B}<br>
	└ ┘表示其中的数值向下取整。
	例如，开单运费为350元，现有面值为100元的优惠券，若设置运费每满100抵20，<br>
	则对于350元的运单，可以抵扣60元，优惠券剩余面值作废。
4)	增值费要求：可设置某项增值费满足一定金额时，才能使用优惠券；<br>
	可选的增值费包括：包装费、保价费、代收费、送货费、接货费，非必填。
5)	使用期限：<br>
	a. 运单可以使用优惠券的时间期限，以开单提交时间为准；<br>
	b. 使用开始日期必须不早于当前日期，使用结束日期不早于开始日期；<br>
	c. 使用期限为必填项，时间精确到分钟。<br>
6)	线路区域要求：下拉选项包括<空>、走货线路、发货区域、到达区域。<br>
	a. 选择<空>，表示线路区域不作为使用优惠券的限制条件。<br>
	b. 选择走货线路，表示生成优惠券的线路要求，可批量添加。<br>
	其中，出发城市和到达城市按运作线路进行选择，基础数据从FOSS中获取。<br>
	例如，运单交接的第一个专线在上海，即认为出发城市为上海。<br>
	c. 选择发货区域，则树状选择框内选中的营业部进行开单时（含集中开单组为该部门开单），<br>
	满足其它限制条件时可使用优惠券，其余部门不能使用该规则下的优惠券；<br>
	组织架构为经营部门，可选层级包括：事业部、大区、小区、营业部（含派送部）。<br>
	d. 选择到达区域，则运单到达部门为树状选择框内选中的部门（含营业部、派送部），<br>
	满足其它限制条件时可使用优惠券，其余部门不能使用该规则下的优惠券；<br>
	组织架构为经营部门，可选层级包括：事业部、大区、小区、营业部（含派送部）。<br>
	【注：在系统性能可以支撑的情况下，期望可以同时限制发货区域与到达区域！】<br>
7)	产品类型：数据来源为FOSS基础数据中已激活的“产品条目”，可多选。<br>
	可选的增值费包括：包装费、保价费、代收费、送货费、接货费，非必填。<br>
8)	订单来源：使用优惠券的下单渠道要求，可多选。 <br>
9)	客户等级：使用优惠券的客户等级要求，选项包括：普通客户、黄金客户、铂金客户、钻石客户，可多选。<br>
	若不选，则表示客户等级不作为判断优惠券使用的条件。设置客户等级时，则默认该优惠券仅限固定客户使用。<br>
10)客户行业：使用优惠券的客户行业要求，可多选。若不选，则表示客户行业不作为判断优惠券使用的条件。<br>
	设置客户等级时，则默认该优惠券仅限固定客户使用。<br>
11)运单开单时只有满足以上8类优惠券的使用要求，才能使用优惠券。
</td><td><a href="#useCoupon">验证优惠券序列图设计</a></td></tr>

<tr><td>RULE-A6</td><td>
<b>短信内容：</b><br>
1)	短信内容分为两部分，第一部分可手动输入，第二部分为系统按规则自动生成，不可编辑；<br>
2)	手动输入部分，限输入80个字。输入过程中，<br>
    提示当前短信字数与累计可输入字数（系统自动生成的短信字数默认为60个，即提示的短信字数从60开始累积）；<br>
3)	系统自动生成部分，显示如下引号中内容："***元优惠券，编码：********，<br>
    有效期至**年**月**日，用券详情请咨询当地营业部！【德邦物流】"。<br>
    （CRM将数据传输到短信网关时，需去掉短信后的【德邦物流】，因为短信系统会自动添加这六个字符）<br>
4)	系统生成优惠券并给客户发信息时，短信内容为手动输入部分+自动生成部分。<br>
    其中，自动生成部分，***元显示当前发送优惠券的返券金额；<br>
	编码显示由系统按规则随机生成优惠券编码；有效期显示优惠券使用期限的使用截止日期。
</td><td></td></tr>

<tr><td>RULE-A7</td><td>
<b>优惠券描述：</b><br>
1)	优惠券描述：即当前优惠券规则信息备注，仅可在系统内查询，限500个字。
</td><td></td></tr>

<tr><td>RULE-A8</td><td>
<b>保存规则：</b><br>
1)保存时校验所有必填项是否填写完整，校验优先级（从高到底）如下：<br>
  营销计划名称、优惠券金额、发放数量、返券期限、返券金额、金额要求、使用期限、短信内容。<br>
2)保存时，如有必填信息未填写，自动将光标定位到优先级最高的必填项，并红框提示；<br>
3)保存成功，弹出提示信息“保存成功”； <br>
</td><td><a href="#saveMarketPlan">同《营销计划新增序列图设计》</a></td></tr>

<tr><td>RULE-A9</td><td>
<b>启用规则：</b><br>
1)启用时校验所有必填项是否填写完整，校验优先级（从高到底）如下：<br>
  营销计划名称、优惠券金额、发放数量、返券期限、返券金额、金额要求、使用期限、短信内容。<br>
2)确认所有必填项完整后，依次校验返券期限、使用期限，是否符合前面所述的时间规则；<br>
3)启用时，如有必填信息未填写，自动将光标定位到优先级最高的必填项，并红框提示；<br>
4)如返券期限或使用期限不合规则，自动将光标定位到至时间控件；当返券期限和使用期限均不合规则，优先定位到返券期限； <br>
5)启用优惠券规则时，不对当前规则与现有规则进行冲突校验，即一个运单可以同时适用多个优惠券规则，生成多个优惠券；<br>
6)对于手动发券，优惠券规则启用后，系统自动生成优惠券，其规则参照: FS_CRM_YX_YHQ _01_02优惠券生成与发放，RULE-A5<br>
7)对于自动返券，优惠券规则启用后，运单符合规则即生成优惠券，其规则参照: FS_CRM_YX_YHQ _01_02优惠券生成与发放，RULE-A6<br>
8)优惠券生成时，自动按规则获得优惠券编码，不可重复。<br>
  优惠券编码生成规则为：年月日+9位随机码（不可重复）；<br>
  其中，年月日为6位数字的优惠券生成日期（年份只取后两位），随机码由0-9数字构成。<br>
</td><td></td></tr>

<tr><td>RULE-A10</td><td>
<b>取消规则：</b><br>
1)	取消规则时，弹窗提示是否取消当前营销计划，确认取消后，当前营销计划不在系统中保存。<br>
</td><td></td></tr>

<tr><td>RULE-A11</td><td>
<b>设置自动返券金额：</b><br>
1)必须且仅限选择一种返券参照费用类型。可选费用类型包括：开单金额、运费、包装费、保价费、代收费、送货费、接货费；<br>
2)可设置多条不同金额下限对应生成的优惠券金额（限10条）；<br>
3)若一个运单适用多个返券金额，按照返券金额最大的进行返券；<br>
4)返券金额为必填信息，至少需设置一条优惠券返券金额规则。<br>
</td><td></td></tr>

<tr><td>RULE-A12</td><td>
<b>设置线路区域要求：</b><br>
1)线路区域要求的下拉菜单，选项包括：<空>、走货线路、发货区域、到达区域；<br>
2)线路区域要求默认为空，此时表示线路区域不作为优惠券生成或使用的判定条件；<br>
3)线路区域选择走货线路，则切换出设置走货线路界面，规则参见：RULE-A13；<br>
4)线路区域选择发货区域，则切换出设置发货区域界面，规则参见：RULE-A14；<br>
5)线路区域选择到达区域，则切换出设置到达区域界面，规则参见：RULE-A15；<br>
6)切换选项是，提示："切换选项会导致当前选项数据丢失，是否切换？"， 选择"是"则切换，选择"否"不切换；<br>
7)当返券规则和使用规则中的线路区域要求选项一致时，激活使用条件区域的"复制返券规则"按钮，<br>
点击时可将返券规则中的线路区域要求复制到使用规则中。如果使用规则区域的列表不为空，则提示是否确认导入。<br>
</td><td></td></tr>

<tr><td>RULE-A13</td><td>
<b>设置走货线路：</b><br>
1)走货线路的出发城市和到达城市，其中一个不为空时，可将当前线路添加到线路列表中；<br>
2)当出发城市选择了一个城市，但到达城市为空时，表示从出发城市走货到任何地区的运单都符合走货线路规则；<br>
3)当到达城市选择了一个城市，但出发城市为空时，表示从任何地区出发，达到该城市的运单，均符合走货线路规则；<br>
4)走货线路列表中，不判断线路是否存在重复，运单只要符合其中任意一条线路要求，均判定符合走货线路规则。<br>
</td><td></td></tr>

<tr><td>RULE-A14</td><td>
<b>设置发货区域：</b><br>
1)	组织架构为经营部门，可选层级包括：事业部、大区、小区、营业部。<br>
</td><td></td></tr>

<tr><td>RULE-A15</td><td>
<b>设置到达区域：</b><br>
1)	组织架构为经营部门，可选层级包括：事业部、大区、小区、营业部（含派送部）。<br>
</td><td></td></tr>


</table>
</fieldset>
</a>

<a  name="coupon">
<fieldset>
<legend>优惠券生成与发放</legend>
<table border="1">
<tr><td colspan="2" align="center">优惠券生成与发放</td><td></td></tr>
<tr><td>RULE-A1</td><td>
<b>输入查询条件：</b><br>
通过营销计划编码查询时，忽略其它查询条件进行精确查询；<br>
营销计划名称支持模糊查询；<br>
启用状态查询条件的选项包括：未启用、已启用、已终止、已结束、全部；<br>
优惠券类型选项包括；手动发券、自动返券、全部；<br>
创建时间，指营销计划的保存时间（直接启用的营销计划，启用时间即为保存时间），<br>
默认值为最近一年，最大查询时间范围为一年；<br>
点击查询时，根据设置的查询条件，在列表区显示筛选出的数据；<br>
点击重置时，清空所有查询条件。<br>
</td><td><a href="#searchMarketPlan">查询营销计划序列图设计</a></td></tr>
<tr><td>RULE-A2</td><td>
<b>显示查询结果：</b><br>
分页显示查询结果，按照营销计划创建时间逆序排列<br>
（即保存时间，对于直接启用的营销计划，保存时间=启用时间），点击表头可排序；<br>
双击列表区的信息，可打开营销计划的查看详情弹窗，弹窗规则参考RULE-A3；<br>
列表区信息，限单选；<br>
每页默认显示20条营销计划信息；<br>
</td><td></td></tr>
<tr><td>RULE-A3</td><td>
<b>查看详情：</b><br>
双击一条营销计划信息或选择一条营销计划信息并点击“查看详情”，可打开营销计划详情界面（同营销计划新增页面，但不可编辑）；<br>
对于不同状态的营销计划，可进行不同操作，具体对应关系如下：<br>
未启用：编辑、启用规则、删除规则；<br>
已启用：终止规则、复制新建；<br>
已终止：复制新建<br>
已结束：复制新建<br>
</td><td><a href="#searchMarketPlan">同《查询营销计划序列图设计》</a></td></tr>
<tr><td>RULE-A4</td><td>
<b>编辑营销计划：</b><br>
优惠券类型不可修改（即不可再设置手动发券或自动返券），其余字段信息编辑规则同营销计划新增界面；<br>
营销计划新增页面中的优惠券类型字段，在编辑界面中替换为营销计划状态字段，显示当前营销计划状态；<br>
</td><td></td></tr>
<tr><td>RULE-A5</td><td>
<b>启用营销计划（手动发券）：</b><br>
启用手动发券营销计划后，营销计划状态由未启用变更为：已启用；<br>
启用营销计划后，系统自动根据手动发券规则中设置的返券数量，生成相应数量的优惠券，并可在优惠券查询中进行查看；<br>
返券数量小于等于10000条，即时生成优惠券，返券数量大于10000条，次日凌晨0点开始生成；<br>
启用手动发券营销计划后，生成的优惠券初始状态为：未发送；<br>
通过手动发券方式生成的优惠券，处于任何状态，均无归属部门<br>
</td><td><a href="#changeStatus">状态变更序列图设计</a></td></tr>
<tr><td>RULE-A6</td><td>
<b>启用营销计划（自动返券）：</b><br>
启用自动返券营销计划后，营销计划状态由未启用变更为：已启用；<br>
启用营销计划后，系统根据返券规则筛选前一天业务完结（运单签收为准）且符合返券条件的运单信息，将优惠券短信发送给发货客户；<br>
发货客户必须有手机号，否则无法获得优惠券；<br>
发送短信时间在9:00-12:00,14:00-19:00之间，其他时间不发送；<br>
优惠券生成时，同时将生成该优惠券的运单的出发部门，作为优惠券归属部门写入CRM优惠券信息中。<br>
</td><td><a href="#changeStatus">状态变更序列图设计</a></td></tr>
<tr><td>RULE-A7</td><td>
<b>终止营销计划（手动发券）：</b><br>
终止手动发券营销计划后，营销计划状态变更为：已终止；<br>
手动发券营销计划终止后，由该营销计划生成的优惠券不受影响，仍按营销计划未终止状态使用。<br>
</td><td><a href="#changeStatus">状态变更序列图设计</a></td></tr>
<tr><td>RULE-A8</td><td>
<b>终止营销计划（自动返券）：</b><br>
终止自动返券营销计划后，营销计划状态变更为：已终止；<br>
营销计划终止后，系统不再判断运单是否符合该返券规则，也不再根据该规则生成或发送优惠券；<br>
营销计划终止后，由该营销计划生成的优惠券不受影响，仍按营销计划未终止状态使用。<br>
</td><td><a href="#changeStatus">状态变更序列图设计</a></td></tr>
<tr><td>RULE-A9</td><td>
<b>复制新建营销计划：</b><br>
对于已启用、已终止、已结束的营销计划，点击复制新建按钮，可打开营销计划新增页面，<br>
并自动将该营销计划信息填入营销计划新增页面；<br>
新建的营销计划与原营销计划，除了编码不同，其它信息一致。<br>
【注：该动作等同于查询详情并编辑该规则！】<br>
</td><td></td></tr>
<tr><td>RULE-A10</td><td>
<b>短信发券：</b><br>
选中一条营销计划，并点击“短信发券”，如果选中的营销计划为自动返券，则提示：<br>
优惠券类型为自动返券的营销计划，不可手动进行短信发券；<br>
如果选择的营销计划为手动发券，则打开短信发券页面；<br>
手动发券页面分两个部分：优惠券信息、发送对象；<br>
优惠券信息的业务规则参考：RULE-A11；<br>
发送对象的业务规则参考：RULE-A12；<br>
手机号码添加或导入到列表中时，校验手机号码的有效性。<br>
手机号码全部为数字构成，无字母或特殊字符，并且为11位时，判定手机号码有效，否则判定手机号码无效；<br>
若未删除无效的手机号码，点击发送时则提示“存在无效的手机号码，不可发送短信”，只有列表内的号码全部有效时才可发送；<br>
若手机号列表中的手机号码数超过限制，则在点击发送时，提示：<br>
“手机号码超过数量限制，不可发送！”，只有列表内的号码数在限制的范围内，才可发送；<br>
手机号码成功传输至短信网关，则将手机号码写入优惠券的“发送手机号码”字段内，并标记发送结果为：成功；<br>
优惠券短信发送完毕后，手机号列表中显示发送结果：成功、失败；<br>
短信发送成功时，优惠券状态由未发送标记为已发送，不可再发送给其它号码；<br>
短信发送失败，手机号码不写入优惠券的“发送手机号码”字段内，优惠券仍为未发送状态，可再次发送；<br>
短信发送完毕后，短信发券界面发送按钮隐藏，只能进行查看。<br>
</td><td><a href="#sendMessage">状态变更序列图设计</a></td></tr>
<tr><td>RULE-A11</td><td>
<b>短信发券-优惠券信息：</b><br>
优惠券信息是由所选营销计划，自动加载相应信息；<br>
发券总数即该营销计划发放规则中的发放数量；<br>
已发送数量为该营销计划生成的所有优惠券中，处于已发送、已使用、已过期状态优惠券的总数；<br>
优惠券的剩余数量=发券总数-已发送数量-已使用数量-已过期数量；<br>
短信内容不可编辑，数据来源为营销计划中设置的短信内容<br>
</td><td></td></tr>

<tr><td>RULE-A12</td><td>
<b>短信发券-发送对象：</b><br>
在手机号码文本框内输入手机号码，点击添加按钮，可将文本框内的手机号码添加到下方列表中，并实时判断号码的有效性；<br>
点击批量导入按钮，打开批量导入弹窗，可下载模板或导入xls/xlsx文件；文件模板如下，手机号码在从第一列第二行以此向下填写、导入。<br>
手机号码导入时，实时判断号码有效性；<br>
若导入的手机号码数量超过限制，也可导入到列表中，但是在发送时提醒：“手机号码超过数量限制，不可发送！”；<br>
短信发券时，添加到列表中的手机号码数量，不能超过当前营销计划剩余优惠券数，且不能超过1000条。若数量达到限制，则不可再向列表中添加手机号码；<br>
列表下方提示最大可录入电话号码数及当前已录入数，描述内容：限1000个，当前共**个；<br>
删除列表中选中的手机号码时，直接删除，无提示；<br>
清除无效号码时，弹窗提示是否清除，选择“是”，则清除列表中状态为无效的手机号码；<br>
清除重复号码时，弹窗提示是否清除，选择“是”，则对于重复的手机号码只保留一个；<br>
若未清除重复的手机号码，同一手机号出现几次，则匹配并发送几个优惠券编码；<br>
</td><td></td></tr>

</table>
</fieldset>
</a>
<a  name="useCoupon">
<fieldset>
<legend>优惠券使用</legend>
<table border="1">
<tr><td colspan="2" align="center">优惠券使用</td><td></td></tr>
<tr><td>RULE-A1</td><td>
<b>优惠券使用规则：</b><br>
一个优惠券编码只能使用一次（有效使用次数），不可重复使用；<br>
一个运单只能使用一张优惠券，不能多张优惠券累加使用；<br>
优惠券只能在开单界面使用，不可在其他界面使用，如更改单；<br>
</td><td><a href="#useCoupon">验证优惠券序列图设计</a></td></tr>
<tr><td>RULE-A2</td><td>
<b>优惠券校验规则：</b><br>
略<br>
</td><td></td></tr>
<tr><td>RULE-A3</td><td>
<b>优惠券冲减规则（此规则适用于Foss运单）：</b><br>
优惠券所有使用条件验证通过后，根据优惠券规则计算实际可抵扣金额，冲减后的开单金额必须大于等于0；<br>
运单提交时，根据优惠券可抵扣金额，进行费用冲减，并标记优惠券状态为已使用；<br>
运单打印时，将优惠金额打印出来；<br>
派送到达联打印时，将优惠金额打印出来。<br>
</td><td></td></tr>
<tr><td>RULE-A4</td><td>
<b>运单信息修改（此规则适用于Foss运单）：</b><br>
优惠券规则校验通过后，若运单信息有修改，则重新验证优惠券是否符合使用规则；<br>
</td><td></td></tr>
<tr><td>RULE-A5</td><td>
<b>运单暂存（此规则适用于Foss运单）：</b><br>
运单暂存时，仅保存优惠券编码；运单再次编辑时，优惠券重新进行完整验证；<br>
</td><td></td></tr>
<tr><td>RULE-A6</td><td>
<b>运单更改（此规则适用于Foss运单）：</b><br>
运单更改：优惠券不再重新验证，冲减金额与运单开单时一致；<br>
</td><td></td></tr>
<tr><td>RULE-A7</td><td>
<b>运单作废：</b><br>
运单作废时，运单使用的优惠券重新激活；<br>
若优惠券未超过使用期限，则优惠券恢复到使用前状态（未发送或已发送），可再次使用；<br>
若优惠券超过使用期限，则优惠券状态标记为已过期，不可使用。<br>
</td><td><a href="#changeStatus">优惠券状态变更序列图设计</a></td></tr>
                                                      
</table>
</fieldset>
</a>
<a  name="searchCoupon">
<fieldset>
<legend>优惠券查询</legend>
<table border="1">
<tr><td colspan="2" align="center">优惠券查询</td><td></td></tr>
<tr><td>RULE-A1</td><td>
<b>输入查询条件：</b><br>
归属部门默认显示用户所属部门。其中权限规则如下：<br>
营销活动管理组默认查询全部优惠券信息（含无归属部门的优惠券信息），并可切换至某一事业部或营业部；<br>
事业部营销管理组默认查询本事业部优惠券发放与使用情况，可切换至某一营业部；营业部默认查询本部门优惠券发放与使用情况，不可切换部门；<br>
通过优惠券编码查询时，不区分优惠券编码字母的大小写；<br>
通过手机号码或优惠券编码查询时，忽视其它查询条件，进行精确查询，并可查询全局优惠券信息（含非本部门的优惠券信息、以及无归属部门的优惠券信息）；<br>
两个都填写时，优先按优惠券编码查询，忽视手机号码。<br>
使用时间范围查询，指在所选时间范围内使用的优惠券；<br>
发送时间范围查询，指在所选时间范围内通过系统短信发送的优惠券；<br>
当营销计划名称为空时，使用时间范围与发送时间范围必填其一，且查询时间范围最长为一个月；<br>
当营销计划名称不为空时，使用时间范围与发送时间范围，不作限制；<br>
点击查询时，根据设置的查询条件，在列表区显示筛选出的数据；<br>
点击重置时，清空所有查询条件。
</td><td><a href="#searchCouponList">优惠券查询序列图设计</a></td></tr>
<tr><td>RULE-A2</td><td>
<b>显示查询结果：</b><br>
分页显示查询结果，按照优惠券生成时间逆序排列，点击表头可排序；<br>
双击列表区的信息，可打开优惠券的使用条件弹窗，弹窗规则参考RULE-A3；<br>
列表区信息，限单选；<br>
每页默认显示20条优惠券信息；<br>
</td><td></td></tr>
<tr><td>RULE-A3</td><td>
<b>查看使用规则：</b><br>
双击一条优惠券信息或选择一条优惠券信息并点击“查看使用规则”，可打开优惠券使用条件弹窗；<br>
弹窗显示优惠券的使用条件。<br>
</td><td><a href="#searchMarketPlan">优惠券使用规则同《查询营销计划列表-详情》</a></td></tr>
<tr><td>RULE-A4</td><td>
<b>重发短信：</b><br>
短信重发功能，仅对已发送状态的优惠券可用；<br>
短信重发功能，每条优惠券累计限发5次（含初次发送），最短发送时间间隔为10分钟；<br>
对于选中的优惠券信息，点击重发短信，对于符合发送条件的优惠券，系统自动按照原发送号码，重新发送一条短信；<br>
短信重发功能，权限无特别限制，具有优惠券查询权限的用户均可使用，但仅能用于有查询权限的优惠券；<br>
列表中，不符合短信重发条件的优惠券，提示不可发送短信原因。<br>
对于处于未发送、已使用、已过期状态的优惠券，提示：只有处于已发送状态的优惠券，才能重新发送短信；<br>
对于达到重发短信次数限制的优惠券，提示：已达到短信发送最大次数限制；<br>
对于发送间隔低于10分钟的优惠券，提示：短信发送过于频繁，请10分钟后再试。<br>
</td><td><a href="#sendMessage">同《发送短信时序图》</a></td></tr>
<tr><td>RULE-A5</td><td>
<b>运单暂存（此规则适用于Foss运单）：</b><br>
运单暂存时，仅保存优惠券编码；运单再次编辑时，优惠券重新进行完整验证；<br>
</td><td></td></tr>
<tr><td>RULE-A6</td><td>
<b>导出全部：</b><br>
导出全部功能，会将当前查询条件下筛选出的全部优惠券导出到本地excel表中，excel表字段与优惠券查询列表字段相同（不含选择框字段）。<br>
</td><td><a href="#importexport">导入导出时序图</a></td></tr>
<tr><td>RULE-A7</td><td>
<b>营销计划名称查询：</b><br>
打开营销计划查询弹窗，列表默认显示所有状态为已启用的营销计划；<br>
通过营销计划编码查询时，不区分营销计划编码字母的大小写；<br>
启用状态选项包括已启用、已终止、已结束、全部。启用状态为全部时，可筛选出状态为已启用、已终止和已结束的营销计划，不可筛选出未启用的营销计划；<br>
通过营销计划编码查询时，忽视其它查询条件，进行精确查询；<br>
查询条件中，启用状态默认：已启用；<br>
双击列表中的一条营销计划，可将该条营销计划名称带入到优惠券查询的营销计划查询名称中，执行优惠券查询时，按该营销计划对应的编码进行查询。<br>
</td><td><a href="#searchMarketPlan">同《查询营销计划列表》</a></td></tr>
                                                      
</table>
</fieldset>
</a>
<div id="saveMarketPlan">
<fieldset>
<legend>新增营销计划序列图设计</legend>
<img src="doc-files/前台-优惠券规则设置1.jpg" alt="" border="1"><br>
<img src="doc-files/前台-优惠券规则设置2.jpg" alt="" border="1"><br>
<img alt="" src="doc-files/新增营销计划.jpg"><br>

</fieldset>
</div>
<div id="autoCoupon">
<fieldset>
<legend>自动返券序列图设计</legend>
<img alt="" src="doc-files/自动返券.jpg">
</fieldset>
</div>
<div id="useCoupon">
<fieldset>
<legend>验证优惠券序列图设计</legend>
<img src="doc-files/前台-优惠券使用规则.jpg" alt="" border="1"><br>
<img alt="" src="doc-files/验证优惠券.jpg"><br>
</fieldset>
</div>
<div id="searchMarketPlan">
<fieldset>
<legend>查询营销计划列表序列图设计</legend>
<img src="doc-files/前台-营销计划管理.jpg" alt="" border="1"><br>
<img src="doc-files/前台-营销计划管理-计划详情.jpg" alt="" border="1"><br>
<img alt="" src="doc-files/查询营销计划列表.jpg"><br>
</fieldset>
</div>
<div id="changeStatus">
<a name="">
<fieldset>
<legend>状态变更时序图</legend>
<img alt="" src="doc-files/状态变更.jpg">
</fieldset>
</a>
</div>
<div id="sendMessage">
<a name="">
<fieldset>
<legend>发送短信时序图</legend>
<img src="doc-files/前台-短信发券.jpg" alt="" border="1"><br>
<img alt="" src="doc-files/发送短信.jpg"><br>
</fieldset>
</a>
</div>
<div id="searchCouponList">
<a name="">
<fieldset>
<legend>查询优惠券列表时序图</legend>
<img src="doc-files/前台-优惠券查询.jpg" alt="" border="1"><br>
<img src="doc-files/前台-优惠券查询-计划查询.jpg" alt="" border="1"><br>
<img alt="" src="doc-files/查询优惠券列表.jpg">
</fieldset>
</a>
</div>
<div id="importexport">
<a name="">
<fieldset>
<legend>导入导出时序图</legend>
<img alt="" src="doc-files/导入导出.jpg">
</fieldset>
</a>
</div>








</body>
</html>