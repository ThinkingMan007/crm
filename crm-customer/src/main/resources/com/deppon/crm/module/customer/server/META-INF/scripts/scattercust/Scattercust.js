Ext.JSON.encodeDate=function(d){return d.getTime();};String.prototype.replaceAll=function(AFindText,ARepText){raRegExp=new RegExp(AFindText,"g");return this.replace(raRegExp,ARepText);};DpUtil=function(){};DpUtil.isEmpty=function(str){return Ext.isEmpty(str);};DpUtil.requestJsonAjax=function(url,params,successFn,failFn,timeout)
{Ext.Ajax.request({url:url,jsonData:params,timeout:(Ext.isEmpty(timeout))?600000:timeout,success:function(response){var result=Ext.decode(response.responseText);if(result.success){successFn(result);}else{failFn(result);}},failure:function(response){var result=Ext.decode(response.responseText);failFn(result);}});};DpUtil.requestJsonAjaxSync=function(url,params,successFn,failFn,timeout)
{Ext.Ajax.request({url:url,async:false,jsonData:params,timeout:(Ext.isEmpty(timeout))?600000:timeout,success:function(response){var result=Ext.decode(response.responseText);if(result.success){successFn(result);}else{failFn(result);}},failure:function(response){var result=Ext.decode(response.responseText);failFn(result);}});};DpUtil.requestFileUploadAjax=function(url,form,successFn,failFn)
{Ext.Ajax.request({url:url,form:form,isUpload:true,success:function(form,action){var result=action.result;if(result.success){successFn(result);}else{failFn(result);}},failure:function(form,action){var result=action.result;failFn(result);}});};DpUtil.requestAjax=function(url,params,successFn,failFn)
{Ext.Ajax.request({url:url,params:params,success:function(response){var result=Ext.decode(response.responseText);if(result.success){successFn(result);}else{failFn(result);}},failure:function(response){var result=Ext.decode(response.responseText);failFn(result);}});};DpUtil.changeLongToDate=function(value){if(value!=null){var date=new Date(value);return date;}else{return null;}};DpUtil.renderDate=function(value){if(value!=null){return Ext.Date.format(new Date(value),'Y-m-d');}else{return null;}};DpUtil.changeDictionaryDescipToCode=function(store,descrip){var record=store.findRecord('codeDesc',descrip);if(!DpUtil.isEmpty(record)){return record.get('code');}else{return"";}};DpUtil.changeDictionaryCodeToDescrip=function(value,dataDictionary){if(value!=null&&dataDictionary!=null){for(var i=0;i<dataDictionary.length;i++){if(value==dataDictionary[i].code){return dataDictionary[i].codeDesc;}}}else{return null;}};DpUtil.changeBooleanToDescrip=function(value){if(value==false){return i18n('i18n.ChangeContactAffiliatedRelationView.no');}else if(value==true){return i18n('i18n.ChangeContactAffiliatedRelationView.yes');}
return null;};DpUtil.changeIntToDescrip=function(value){if(value==0){return i18n('i18n.ChangeContactAffiliatedRelationView.no');}else if(value==1){return i18n('i18n.ChangeContactAffiliatedRelationView.yes');}
return null;};DpUtil.changeNullToEmptyString=function(value){if(value==null){return'';}else{return value}};DpUtil.compareRecordFieldIsChange=function(oldValue,newValue){if(oldValue==newValue){return false;}else if(DpUtil.changeNullToEmptyString(oldValue)==DpUtil.changeNullToEmptyString(newValue)){return false;}else{return true;}};DpUtil.keyPress=function(e,getData,param,limit,successFn){var paramValue=e.target.value;if(Ext.isEmpty(paramValue)){return;}
if(paramValue.length<limit){return;}
if(e.getKey()==Ext.EventObject.ENTER&&paramValue!=""&&paramValue.length>=limit)
{var failureFn=function(json){DpUtil.showMessage(json.message);};getData(param,successFn,failureFn);}};DpUtil.showMessage=function(meaage){top.Ext.MessageBox.alert(i18n('i18n.PotentialCustManagerView.message'),meaage);};DpUtil.showConfimMessageBox=function(msg,message,yesFn,noFn){Ext.MessageBox.confirm(msg,message,function(e){if(e=='yes'){yesFn;}else{noFn;}});};DpUtil.createStore=function(storeId,model,fields,data){var store=Ext.data.StoreManager.lookup(storeId);if(Ext.isEmpty(data)){data=[];}
if(!Ext.isEmpty(model)){if(store===undefined){store=Ext.create('Ext.data.Store',{storeId:storeId,model:model,data:data});}}
if(!Ext.isEmpty(fields)){if(store===undefined){store=Ext.create('Ext.data.Store',{storeId:storeId,fields:fields,data:data});}}
return store;};DpUtil.changeLongToDate=function(value){if(value!=null){var date=new Date(value);return date;}else{return null;}};DpUtil.trimString=function(value){if(!Ext.isEmpty(value)){return value.trim();}
return value;};DpUtil.createDateCombo=function(fieldLabel,name,store,allowBlank,readOnly,labelWidth,width,blankText,changEvent){var fn=function(){};var chang=function(field,newValue){if(Ext.isEmpty(newValue)){field.setValue(null);}};var combo=Ext.create('Ext.form.ComboBox',{fieldLabel:fieldLabel,xtype:'combobox',queryMode:'local',forceSelection:true,displayField:'codeDesc',valueField:'code',allowBlank:allowBlank,readOnly:readOnly,name:name,labelWidth:labelWidth,width:width,store:store,blankText:blankText,listeners:{change:(changEvent==null)?fn:((changEvent==true)?chang:changEvent)}});return combo;};Ext.define('DpComboBox',{extend:'Ext.form.ComboBox',alias:['widget.dpcombobox','widget.dpcombo'],setReadOnly:function(readOnly){this.callParent(arguments);if(readOnly){this.addCls('readonly');}else{this.removeCls('readonly');}}});Ext.define('DpNumberField',{extend:'Ext.form.Number',alias:['widget.dpnumberfield','widget.dpnumber'],setReadOnly:function(readOnly){this.callParent(arguments);if(readOnly){this.addCls('readonly');}else{this.removeCls('readonly');}}});Ext.define('DpDateField',{extend:'Ext.form.Date',alias:['widget.dpdatefield','widget.dpdate'],setReadOnly:function(readOnly){this.callParent(arguments);if(readOnly){this.addCls('readonly');}else{this.removeCls('readonly');}}});Ext.define('DpTimeField',{extend:'Ext.form.Time',alias:'widget.dpdtimefield',setReadOnly:function(readOnly){this.callParent(arguments);if(readOnly){this.addCls('readonly');}else{this.removeCls('readonly');}}});DpUtil.getCurrentMonthDays=function(month){var currentMonth=month+1;switch(currentMonth){case 1:case 3:case 5:case 7:case 8:case 10:case 12:return 31;break;case 2:return 28;break;default:return 30;break;　　}}
DpUtil.keyPress=function(e,getData,param,limit,successFn){var paramValue=e.target.value;if(Ext.isEmpty(paramValue)){return;}
if(paramValue.length<limit){return;}
if(e.getKey()==Ext.EventObject.ENTER&&paramValue!=""&&paramValue.length>=limit)
{var failureFn=function(json){DpUtil.showMessage(json.message);};getData(param,successFn,failureFn);}};DpUtil.checkDataInOneYear=function(objPre,objNext){var success=true;var message='';if((DpUtil.isEmpty(objPre.getValue())||DpUtil.isEmpty(objNext.getValue()))){var success=false;var message=i18n('i18n.DpUtil.d_notAllDateNull');}else if(!DpUtil.isEmpty(objPre.getValue())&&!DpUtil.isEmpty(objNext.getValue())){if(objPre.getValue()>objNext.getValue()){var success=false;var message=i18n('i18n.DpUtil.d_startNotBigger');}else{if(objNext.getValue().getFullYear()-objPre.getValue().getFullYear()<=1){if(objNext.getValue().getFullYear()-objPre.getValue().getFullYear()==1){var monthsNext=objNext.getValue().getMonth()-objPre.getValue().getMonth()+12;if(monthsNext<=12){if(monthsNext==12){if(objNext.getValue().getDate()>objPre.getValue().getDate()){var success=false;var message=i18n('i18n.DpUtil.d_intervalBigger');}}}else{var success=false;var message=i18n('i18n.DpUtil.d_intervalBigger');}}}else{var success=false;var message=i18n('i18n.DpUtil.d_intervalBigger');}}}
return{success:success,message:message};}
DpUtil.checkDataInOneYear1=function(year,month,day){var data=new Date();data.setYear(new Date().getYear()+year);data.setYear(new Date().getMonth()+month);data.setYear(new Date().getDay()+day);if((DpUtil.isEmpty(objPre.getValue())||DpUtil.isEmpty(objNext.getValue()))){var success=false;var message=i18n('i18n.DpUtil.d_notAllDateNull');}else if(!DpUtil.isEmpty(objPre.getValue())&&!DpUtil.isEmpty(objNext.getValue())){if(objPre.getValue()>objNext.getValue()){var success=false;var message=i18n('i18n.DpUtil.d_startNotBigger');}else{if(objNext.getValue().getFullYear()-objPre.getValue().getFullYear()<=1){var monthsNext=objNext.getValue().getMonth()-objPre.getValue().getMonth()+12;if(monthsNext>=0&&monthsNext<=12){if(monthsNext==12){if(objNext.getValue().getDate()>objPre.getValue().getDate()){var success=false;var message=i18n('i18n.DpUtil.d_intervalBigger');}}}}}}}
DpUtil.linkWayLimit=function(regText){var mobil=/^1\d{10}$/;var tel=/^\d{3}[\d\*-/]{4,17}$/;var idCard=/^([\d]{15}|[\d]{18}|[\d]{17}X)$/;var defaultValue=/^\d{11}$/;switch(regText){case'M':return mobil;break;case'T':return tel;break;case'I':return tel;break;default:return defaultValue;break;　　}}
DpUtil.defaultDept=function(form,fieldName){var dept=form.getForm().findField(fieldName);dept.store.add(Ext.create('CurrentUserDeptListModel',{'deptId':top.User.deptId,'deptName':top.User.deptName}));dept.setValue(top.User.deptId);}
Ext.define('DataDictionaryModel',{extend:'Ext.data.Model',fields:['code','codeDesc']});Ext.define('IndustryStore',{extend:'Ext.data.Store',model:'DataDictionaryModel',data:null});Ext.define('CoopertationCompanyStore',{extend:'Ext.data.Store',model:'DataDictionaryModel',data:null});Ext.define('CoopertationIntensionStore',{extend:'Ext.data.Store',model:'DataDictionaryModel',data:null});Ext.define('GoodsPotentialStore',{extend:'Ext.data.Store',model:'DataDictionaryModel',data:null});Ext.define('BusinessOpportunityStore',{extend:'Ext.data.Store',model:'DataDictionaryModel',data:null});Ext.define('CompanySizeStore',{extend:'Ext.data.Store',model:'DataDictionaryModel',data:null});Ext.define('CompanyNatureStore',{extend:'Ext.data.Store',model:'DataDictionaryModel',data:null});Ext.define('CustPropertyStore',{extend:'Ext.data.Store',model:'DataDictionaryModel',data:null});Ext.define('CustNatureStore',{extend:'Ext.data.Store',model:'DataDictionaryModel',data:null});Ext.define('ScatterCustModel',{extend:'Ext.data.Model',fields:['id','custName','linkManName','memberNo','trade','linkManPhone','linkManMobile','idNumber','companySize','companyNature','taxregistNo','post','city','cityName','address','custProperty','leaDeptId','leaDeptName','arrDeptId','arrDeptName','bussinesState','custNature','remark','recentcoop','coopIntention','volumePotential','recentGoods','custNeed','developState',{name:'finalreviTime',type:'date',convert:DpUtil.changeLongToDate,defaultValue:null},{name:'reviTimes',type:'int'},{name:'programmeTime',type:'date',convert:DpUtil.changeLongToDate,defaultValue:null},'createUser',{name:'createDate',type:'date',convert:DpUtil.changeLongToDate,defaultValue:new Date()},{name:'modifyDate',type:'date',convert:DpUtil.changeLongToDate,defaultValue:new Date()},'modifyUser'],hasMany:{model:'TransactionModel',name:'transactions',associationKey:'transactions',primaryKey:'id',foreignKey:'custId'}});Ext.define('TransactionModel',{extend:'Ext.data.Model',fields:['id','custId','monthKind',{name:'totalBillCount',type:'int'},{name:'recTotalBillCount',type:'int'},'totalWeight','recTotalWeight','totalAmount','recTotalAmount']});Ext.define('ScatterCustStore',{extend:'Ext.data.Store',model:'ScatterCustModel',pageSize:20,proxy:{type:'ajax',api:{read:'searchScatterCustList.action'},actionMethods:'POST',reader:{type:'json',root:'scatterCustlist',totalProperty:'totalCount'}}});Ext.define('TransactionStore',{extend:'Ext.data.Store',model:'TransactionModel',proxy:{type:'ajax',actionMethods:'POST',url:'searchTransaction.action',reader:{type:'json',root:'transactions'}}});Ext.define('ScatterCustBasicData',{industryStore:null,coopertationCompanyStore:null,coopertationIntensionStore:null,goodsPotentialStore:null,businessOpportunityStore:null,cityStore:null,scatterCustStore:null,companySizeStore:null,companyNatureStore:null,custPropertyStore:null,custNatureStore:null,transactionStore:null,getIndustryStore:function(){if(this.industryStore==null){this.industryStore=Ext.create('IndustryStore',{data:DataDictionary.TRADE});}
return this.industryStore;},getCoopertationCompanyStore:function(){if(this.coopertationCompanyStore==null){this.coopertationCompanyStore=Ext.create('CoopertationCompanyStore',{data:DataDictionary.COOPERATION_LOGISTICS});}
return this.coopertationCompanyStore;},getCoopertationIntensionStore:function(){if(this.coopertationIntensionStore==null){this.coopertationIntensionStore=Ext.create('CoopertationIntensionStore',{data:DataDictionary.COOPERATION_INTENTION});}
return this.coopertationIntensionStore;},getGoodsPotentialStore:function(){if(this.goodsPotentialStore==null){this.goodsPotentialStore=Ext.create('GoodsPotentialStore',{data:DataDictionary.CARGO_POTENTIAL});}
return this.goodsPotentialStore;},getBusinessOpportunityStore:function(){if(this.businessOpportunityStore==null){this.businessOpportunityStore=Ext.create('BusinessOpportunityStore',{data:DataDictionary.BUSINESS_STATUS});}
return this.businessOpportunityStore;},getCompanySizeStore:function(){if(this.companySizeStore==null){this.companySizeStore=Ext.create('CompanySizeStore',{data:DataDictionary.FIRM_SIZE});}
return this.companySizeStore;},getCompanyNatureStore:function(){if(this.companyNatureStore==null){this.companyNatureStore=Ext.create('CompanyNatureStore',{data:DataDictionary.COMP_NATURE});}
return this.companyNatureStore;},getCustPropertyStore:function(){if(this.custPropertyStore==null){this.custPropertyStore=Ext.create('CustPropertyStore',{data:DataDictionary.CUSTOMER_NATURE});}
return this.custPropertyStore;},getCustNatureStore:function(){if(this.custNatureStore==null){this.custNatureStore=Ext.create('CustNatureStore',{data:DataDictionary.CUSTOMER_TYPE});}
return this.custNatureStore;},getScatterCustStore:function(){return this.scatterCustStore;},initialScatterCustStore:function(beforeLoadScatterFn){if(this.scatterCustStore==null){if(beforeLoadScatterFn!=null){this.scatterCustStore=Ext.create('ScatterCustStore',{listeners:{beforeload:beforeLoadScatterFn}});}else{this.scatterCustStore=Ext.create('ScatterCustStore');}}
return this.scatterCustStore;},initialTransactionStore:function(beforeLoadTransactionFn){if(this.transactionStore==null){if(beforeLoadTransactionFn!=null){this.transactionStore=Ext.create('TransactionStore',{listeners:{beforeload:beforeLoadTransactionFn}});}else{this.transactionStore=Ext.create('TransactionStore');}}
return this.transactionStore;},getTransactionStore:function(){if(this.transactionStore==null){this.transactionStore=Ext.create('TransactionStore');}
return this.transactionStore;}});
Ext.define('CityModel',{extend:'Ext.data.Model',fields:['id','cityName']});Ext.define('ScatterCustData',{extend:'ScatterCustBasicData',cityStore:null,updateScatterCust:function(params,saveSuccessFn,saveFailFn){DpUtil.requestJsonAjax('updateScatterCust.action',params,saveSuccessFn,saveFailFn);},getCityStore:function(){return this.cityStore;}});
Ext.define('ScatterCustConditionModel',{extend:'Ext.data.Model',fields:[{name:'custName'},{name:'industry'},{name:'coopIntention'},{name:'custAttribute'},{name:'contacterName'},{name:'contacterMobile'},{name:'contacterPhone'},{name:'position'},{name:'volumePotential'},{name:'beginTime',type:'date',convert:DpUtil.changeLongToDate,defaultValue:(new Date().setDate(new Date().getDate()-30))},{name:'overTime',type:'date',convert:DpUtil.changeLongToDate,defaultValue:new Date()},{name:'businessStatus'},{name:'beginShipWeight'},{name:'overShipWeight'},{name:'beginShipVotes',type:'int'},{name:'overShipVotes',type:'int'},{name:'beginShipAmount'},{name:'overShipAmount'},{name:'beginArrivalWeight'},{name:'overArrivalWeight'},{name:'beginArrivalVotes',type:'int'},{name:'overArrivalVotes',type:'int'},{name:'beginArrivalAmount'},{name:'overArrivalAmount'}]});Ext.define('ScatterCustSearchData',{extend:'ScatterCustBasicData',deleteScatterCustomer:function(params,successFn,failFn){var deleteScatterCustomerUrl='deleteScatterCustById.action';DpUtil.requestJsonAjax(deleteScatterCustomerUrl,params,successFn,failFn);},serachScatterById:function(params,successFn,failFn){var serachScatterByIdUrl='searchScatterCustById.action';DpUtil.requestJsonAjax(serachScatterByIdUrl,params,successFn,failFn);}});
var scatterCustControl=Ext.create('ScatterCustData');Ext.define('ScatterCustEditWindow',{extend:'PopWindow',title:i18n('i18n.ScatterCustManagerView.scatterEditUi'),fbar:null,basicScatterCustInfo:null,scatterCustBusinessInfo:null,scatterCustData:scatterCustControl,height:470,width:690,layout:'fit',viewStatus:null,scatterCustRecord:null,scatterCustManagerView:null,initComponent:function(){var me=this;me.fbar=me.getFbar();me.basicScatterCustInfo=Ext.create('BasicScatterCustForm',{'scatterCustData':me.scatterCustData,'parent':me});me.scatterCustBusinessInfo=Ext.create('ScatterBusinessForm',{'scatterCustData':me.scatterCustData});me.items=[{xtype:'basicformpanel',layout:{type:'vbox',align:'stretch'},items:[{xtype:'basicpanel',layout:'fit',flex:1.5,items:[me.basicScatterCustInfo]},{xtype:'basicpanel',layout:'fit',flex:1,items:[me.scatterCustBusinessInfo]}]}];this.callParent();me.controlComponentByViewStatus();},beforeCloseEvent:function(){if(this.scatterCustManagerView){this.scatterCustManagerView.reloadScatterCust(this.scatterCustRecord);}},controlComponentByViewStatus:function(){var basicForm=this.down('basicformpanel');if(this.scatterCustRecord==null){MessageUtil.showMessage(i18n('i18n.PotentialCustManagerView.incomingScatter'));}else{basicForm.getForm().loadRecord(this.scatterCustRecord);if(this.viewStatus=='view'){this.lockAllComponent();}}},lockAllComponent:function(){var basicForm=this.down('basicformpanel');var mainForm=basicForm.getForm();mainForm.getFields().each(function(field){field.setReadOnly(true);});},getFbar:function(){var me=this;return[{xtype:'button',text:i18n('i18n.PotentialCustEditView.save'),scope:me,handler:me.saveScatterCust},{xtype:'button',text:i18n('i18n.PotentialCustEditView.cancel'),scope:me,handler:me.cancelSaveScatter}];},saveScatterCust:function(button){var me=this;if(me.basicScatterCustInfo.getForm().isValid()){var basicForm=this.down('basicformpanel');var mainForm=basicForm.getForm();mainForm.updateRecord(me.scatterCustRecord);var saveSuccessFn=function(result){MessageUtil.showInfoMes(i18n('i18n.PotentialCustEditView.saveSuccess'));me.scatterCustRecord.set('id',result.scatterCust.id);if(me.scatterCustManagerView){me.scatterCustManagerView.reloadScatterCust(me.scatterCustRecord);}
me.close();};var saveFailFn=function(result){MessageUtil.showErrorMes(result.message);button.setDisabled(false);};var params={};params.scatterCust=me.scatterCustRecord.data;me.scatterCustData.updateScatterCust(params,saveSuccessFn,saveFailFn);button.setDisabled(true);}else{MessageUtil.showMessage(i18n('i18n.ScatterCustManagerView.message_ReFill'));}},cancelSaveScatter:function(){this.close();}});Ext.define('BasicScatterCustForm',{extend:'BasicFormPanel',scatterCustData:null,items:null,parent:null,initComponent:function(){this.items=this.getItems();this.callParent();},getItems:function(){var me=this;return[{xtype:'fieldset',title:i18n('i18n.ScatterCustManagerView.scatterInfo'),layout:{type:'table',columns:3},defaultType:'textfield',defaults:{labelWidth:70,width:210,enableKeyEvents:true,listeners:{scope:me,keypress:me.enterKeyEvent,change:me.changeEvent}},items:[{fieldLabel:i18n('i18n.PotentialCustManagerView.customerName'),name:'custName',readOnly:true,maxLength:20,maxLengthText:i18n('i18n.ManualRewardIntegralEditView.m_maxLength',20),allowBlank:false,blankText:i18n('i18n.ScatterCustManagerView.message_custNameNotNull')},{fieldLabel:i18n('i18n.PotentialCustManagerView.contactName'),name:'linkManName',readOnly:true,maxLength:20,maxLengthText:i18n('i18n.ManualRewardIntegralEditView.m_maxLength',20),allowBlank:false,blankText:i18n('i18n.ScatterCustManagerView.message_linkManNameNotNull')},{fieldLabel:i18n('i18n.ScatterCustManagerView.memberNo'),name:'memberNo',disabled:true},{fieldLabel:i18n('i18n.PotentialCustManagerView.industry'),xtype:'dpcombo',store:me.scatterCustData.getIndustryStore(),queryMode:'local',forceSelection:true,displayField:'codeDesc',valueField:'code',name:'trade'},{fieldLabel:i18n('i18n.PotentialCustManagerView.contactTel'),name:'linkManPhone',regex:DpUtil.linkWayLimit('T'),disabled:true},{fieldLabel:i18n('i18n.PotentialCustManagerView.contactPhone'),name:'linkManMobile',regex:DpUtil.linkWayLimit('M'),disabled:true},{fieldLabel:i18n('i18n.ScatterCustManagerView.idNumber'),name:'idNumber',vtype:'alphanum',maxLength:18,minLength:15,regex:DpUtil.linkWayLimit('I'),regexText:i18n('i18n.MemberCustEditView.cardNum15118LastxX'),maxLengthText:i18n('i18n.ScatterCustManagerView.message_IdNoMax'),minLengthText:i18n('i18n.ScatterCustManagerView.message_IdNoMin')},{fieldLabel:i18n('i18n.ScatterCustManagerView.companySize'),xtype:'dpcombo',store:me.scatterCustData.getCompanySizeStore(),queryMode:'local',forceSelection:true,displayField:'codeDesc',valueField:'code',name:'companySize'},{fieldLabel:i18n('i18n.ScatterCustManagerView.companyProperties'),xtype:'dpcombo',store:me.scatterCustData.getCompanyNatureStore(),queryMode:'local',forceSelection:true,displayField:'codeDesc',valueField:'code',name:'companyNature'},{fieldLabel:i18n('i18n.ScatterCustManagerView.taxId'),name:'taxregistNo'},{fieldLabel:i18n('i18n.PotentialCustManagerView.position'),maxLength:20,maxLengthText:i18n('i18n.ManualRewardIntegralEditView.m_maxLength',20),name:'post'},{fieldLabel:i18n('i18n.PotentialCustEditView.city'),name:'cityName',readOnly:true},{fieldLabel:i18n('i18n.PotentialCustEditView.address'),colspan:3,width:630,maxLength:100,maxLengthText:i18n('i18n.ManualRewardIntegralEditView.m_maxLength',100),name:'address'},{fieldLabel:i18n('i18n.ScatterCustManagerView.custAttribute'),xtype:'dpcombo',store:me.scatterCustData.getCustPropertyStore(),queryMode:'local',forceSelection:true,displayField:'codeDesc',valueField:'code',name:'custNature',readOnly:true,allowBlank:false,blankText:i18n('i18n.ScatterCustManagerView.custAttributeNotNull')},{fieldLabel:i18n('i18n.PotentialCustManagerView.bizStatus'),xtype:'dpcombo',store:me.scatterCustData.getBusinessOpportunityStore(),queryMode:'local',forceSelection:true,displayField:'codeDesc',valueField:'code',name:'bussinesState',disabled:true},{fieldLabel:i18n('i18n.ScatterCustManagerView.custProperty'),xtype:'dpcombo',store:me.scatterCustData.getCustNatureStore(),queryMode:'local',forceSelection:true,displayField:'codeDesc',valueField:'code',name:'custProperty'},{fieldLabel:i18n('i18n.ScatterCustManagerView.remark'),colspan:3,width:630,maxLength:200,maxLengthText:i18n('i18n.ManualRewardIntegralEditView.m_maxLength',200),name:'remark'},{xtype:'hiddenfield',name:'city'},{fieldLabel:i18n('i18n.ScatterCustManagerView.startDept'),name:'leaDeptId',hidden:true,disabled:true},{fieldLabel:i18n('i18n.ScatterCustManagerView.arriveDept'),name:'arrDeptId',hidden:true,disabled:true}]}];},enterKeyEvent:function(field,event){if(event.getKey()==Ext.EventObject.ENTER){if(field.next()==null){field=Ext.getCmp('recentcoop_id');field.focus();}else{while(field.next().readOnly||field.next().disabled){field=field.next();}
field.next().focus();}}},changeEvent:function(field,newValue){var me=this;if(Ext.isEmpty(newValue)&&'dpcombobox'==field.getXType()){field.setValue(null);}},getCity:function(){var me=this;var returnValue=Ext.create('Ext.form.ComboBox');var operateType='add';if('view'==me.parent.viewStatus){operateType='VIEW';}else if('update'==me.parent.viewStatus){operateType='UPDATE';}else if('add'==me.parent.viewStatus){operateType='ADD';}
returnValue=new AreaAddressCombox({'id':'city','fieldLabel':i18n('i18n.PotentialCustEditView.city'),'labelWidth':70,'width':200,'minWidth':200,'name':'city','operateType':operateType,'selectedValue':me.parent.scatterCustRecord.get('city'),'tabPanel':['provincePanel','cityPanel']});return returnValue;}});Ext.define('ScatterBusinessForm',{extend:'BasicFormPanel',scatterCustData:null,items:null,initComponent:function(){this.items=this.getItems();this.callParent();},getItems:function(){var me=this;return[{xtype:'fieldset',title:i18n('i18n.ScatterCustManagerView.scatterBusinessInfo'),layout:{type:'table',columns:3},defaults:{labelWidth:70,width:210,enableKeyEvents:true,listeners:{scope:me,keypress:me.enterKeyEvent,change:me.changeEvent}},items:[{fieldLabel:i18n('i18n.PotentialCustEditView.companyName'),xtype:'dpcombo',store:me.scatterCustData.getCoopertationCompanyStore(),queryMode:'local',forceSelection:true,displayField:'codeDesc',valueField:'code',name:'recentcoop',id:'recentcoop_id'},{fieldLabel:i18n('i18n.PotentialCustManagerView.coopIntention'),xtype:'dpcombo',store:me.scatterCustData.getCoopertationIntensionStore(),queryMode:'local',forceSelection:true,displayField:'codeDesc',valueField:'code',name:'coopIntention'},{fieldLabel:i18n('i18n.PotentialCustManagerView.goodsPotential'),xtype:'dpcombo',store:me.scatterCustData.getGoodsPotentialStore(),queryMode:'local',forceSelection:true,displayField:'codeDesc',valueField:'code',name:'volumePotential'},{fieldLabel:i18n('i18n.PotentialCustEditView.goodsTrendCondition'),xtype:'textareafield',name:'recentGoods'},{fieldLabel:i18n('i18n.PotentialCustEditView.custNeed'),xtype:'textareafield',colspan:2,width:420,name:'custNeed'}]}];},changeEvent:function(field,newValue){var me=this;if(Ext.isEmpty(newValue)&&'dpcombobox'==field.getXType()){field.setValue(null);}},enterKeyEvent:function(field,event){if(event.getKey()==Ext.EventObject.ENTER&&field.name!='custNeed'){if(field.next()!=null){while(field.next().readOnly||field.next().disabled){field=field.next();}
field.next().focus();}}}});Ext.define('ScatterCustDetailWindow',{extend:'PopWindow',title:i18n('i18n.ScatterCustManagerView.custDetailInfo'),layout:'border',y:0,height:600,width:690,basicScatterCustInfo:null,scatterCustBusinessInfo:null,scatterCustData:scatterCustControl,scatterCustRecord:null,items:null,fbar:null,initComponent:function(){var me=this;me.basicScatterCustInfo=Ext.create('BasicScatterCustForm',{'scatterCustData':me.scatterCustData,'parent':me});me.scatterCustBusinessInfo=Ext.create('ScatterBusinessForm',{'scatterCustData':me.scatterCustData});me.fbar=me.getFbar();me.items=me.getItems();me.scatterCustData.getTransactionStore().load({params:{'scatterCust.linkManName':me.scatterCustRecord.get('linkManName'),'scatterCust.linkManMobile':me.scatterCustRecord.get('linkManMobile'),'scatterCust.linkManPhone':me.scatterCustRecord.get('linkManPhone'),'scatterCust.id':me.scatterCustRecord.get('id')}});this.callParent();me.down('basicformpanel').loadRecord(me.scatterCustRecord);me.lockAllComponent();},getFbar:function(){var me=this;return[{xtype:'button',text:i18n('i18n.ScatterCustManagerView.close'),handler:function(){me.close();}}]},lockAllComponent:function(){var basicForm=this.down('basicformpanel');var mainForm=basicForm.getForm();mainForm.getFields().each(function(field){field.setReadOnly(true);});},getItems:function(){var me=this;var rendertoVotes=function(value){return value+i18n('i18n.ScatterCustManagerView.rendertoVotes')};var rendertoVolume=function(value){return value+i18n('i18n.ScatterCustManagerView.rendertoVolume')};var rendertoAmount=function(value){return value+i18n('i18n.ScatterCustManagerView.rendertoAmount')};return[{xtype:'basicformpanel',region:'north',height:350,layout:{type:'vbox',align:'stretch'},items:[{xtype:'basicpanel',layout:'fit',height:220,items:[me.basicScatterCustInfo]},{xtype:'basicpanel',layout:'fit',height:145,items:[me.scatterCustBusinessInfo]}]},{xtype:'basicvboxpanel',region:'center',items:[{xtype:'titlepanel',height:23,items:[{xtype:'displayfield',value:i18n('i18n.ScatterCustManagerView.tradeInfo')}]},{xtype:'popupgridpanel',flex:1,store:me.scatterCustData.getTransactionStore(),columns:[{text:i18n('i18n.ScatterCustManagerView.month'),dataIndex:'monthKind',renderer:me.renderGridDescrip,width:80},{text:i18n('i18n.ScatterCustManagerView.beginShipVotes'),dataIndex:'totalBillCount',renderer:rendertoVotes,width:82},{text:i18n('i18n.ScatterCustManagerView.beginArrivalVotes'),dataIndex:'recTotalBillCount',renderer:rendertoVotes,width:82},{text:i18n('i18n.ScatterCustManagerView.startVolume'),dataIndex:'totalWeight',renderer:rendertoVolume,width:82},{text:i18n('i18n.ScatterCustManagerView.beginArrivalWeight'),dataIndex:'recTotalWeight',renderer:rendertoVolume,width:82},{text:i18n('i18n.ScatterCustManagerView.beginShipAmount'),dataIndex:'totalAmount',renderer:rendertoAmount,width:82},{text:i18n('i18n.ScatterCustManagerView.beginArrivalAmount'),dataIndex:'recTotalAmount',renderer:rendertoAmount,width:82}]}]}];},renderGridDescrip:function(rowId){if(rowId=='0'){return i18n('i18n.ScatterCustManagerView.preMonth');}else if(rowId=='1'){return i18n('i18n.ScatterCustManagerView.currentMonth');}
return'';}});
var scatterCustDataControl=new ScatterCustSearchData();Ext.define('ScatterCustManagerPanel',{extend:'BasicPanel',autoScroll:true,searchCondition:null,searchResult:null,scatterCust:null,layout:{type:'vbox',align:'stretch'},initComponent:function(){var me=this;var record=new ScatterCustConditionModel();me.searchCondition=new SearchConditionForm({'scatterCust':me.scatterCust,'record':record,'parent':me});me.searchCondition.loadRecord(record);me.searchCondition.getForm().reset();var date=new Date();me.searchCondition.getForm().findField("overTime").setValue(date);date.setDate(new Date().getDate()-30);me.searchCondition.getForm().findField("beginTime").setValue(date);me.searchResult=new SearchResultGrid({'scatterCust':me.scatterCust,'parent':me});me.buttonBar=me.getButtonBar();me.items=me.getItems();this.callParent();},getButtonBar:function(){var me=this;return new ScatterCustManagerButtonPanel({'parent':me});},getItems:function(){var me=this;return[{xtype:'basicpanel',height:172,items:[me.searchCondition]},{xtype:'basicpanel',height:36,items:[me.buttonBar]},{xtype:'basicpanel',flex:1,items:[me.searchResult]}];},reloadScatterCust:function(record){var me=this;var store=me.scatterCust.getScatterCustStore();var reloadScatterCustSuccess=function(response){store.insert(0,response.scatterCust);};var reloadScatterCustSuccessFail=function(response){MessageUtil.showMessage(response.message);};store.remove(record);if(DpUtil.isEmpty(record.get('id'))){return;}
var count=store.getCount();if(count>=20){store.remove(store.getAt(count-1));}
var params={};params.scatterCustId=record.get('id');me.scatterCust.serachScatterById(params,reloadScatterCustSuccess,reloadScatterCustSuccessFail);}});Ext.define('ScatterCustManagerButtonPanel',{extend:'NormalButtonPanel',parent:null,items:null,parent:null,initComponent:function(){this.items=this.getItems();this.callParent();},getItems:function(){var me=this;return[{xtype:'leftbuttonpanel',width:270,items:[{text:i18n('i18n.PotentialCustManagerView.viewDetails'),hidden:!isPermission('/customer/ScatterVBtn.action'),xtype:'button',scope:me.parent.searchResult,handler:function(){var grid=Ext.getCmp('searchScatterCustResultGrid');selection=grid.getSelectionModel().getSelection();if(selection.length!=1){MessageUtil.showMessage(i18n('i18n.PotentialCustManagerView.operation_message'));return;}
me.parent.searchResult.lookScatterCustDetail(grid,selection[0]);}},{text:i18n('i18n.PotentialCustManagerView.update'),hidden:!isPermission('/customer/ScatterUBtn.action'),xtype:'button',scope:me.parent.searchResult,handler:me.parent.searchResult.updateScatterCust},{text:i18n('i18n.PotentialCustManagerView.delete'),hidden:!isPermission('/customer/ScatterDBtn.action'),xtype:'button',scope:me.parent.searchResult,handler:me.parent.searchResult.delScatterCust},{text:i18n('i18n.PotentialCustManagerView.visitLog'),xtype:'button',scope:me.parent,hidden:true,handler:me.parent.searchResult.addNewVisit}]},{xtype:'middlebuttonpanel'},{xtype:'rightbuttonpanel',width:150,items:[{xtype:'button',text:i18n('i18n.PotentialCustManagerView.search'),hidden:!isPermission('/customer/ScatterSBtn.action'),width:70,scope:me.parent.searchCondition,handler:me.parent.searchCondition.searchScatterCustomerList}]}];}});Ext.define('SearchConditionForm',{extend:'SearchFormPanel',id:'searchScatterCustConditionForm',items:null,parent:null,record:null,scatterCust:null,layout:'fit',layout:{type:'table',columns:12},defaultType:'textfield',initComponent:function(){var me=this;scatterCust=me.scatterCust;me.defaults=me.getDefaultsContainer();me.items=me.getItems();this.callParent();},getItems:function(){var me=this;return[{fieldLabel:i18n('i18n.PotentialCustManagerView.customerName'),colspan:3,name:'custName',maxLength:20,maxLengthText:i18n('i18n.ManualRewardIntegralEditView.m_maxLength',20)},{fieldLabel:i18n('i18n.PotentialCustManagerView.contactName'),colspan:3,name:'contacterName',maxLength:20,maxLengthText:i18n('i18n.ManualRewardIntegralEditView.m_maxLength',20)},{fieldLabel:i18n('i18n.PotentialCustManagerView.contactPhone'),colspan:3,name:'contacterMobile',regexText:i18n('i18n.ScatterCustManagerView.message_rightString'),regex:DpUtil.linkWayLimit('M')},{fieldLabel:i18n('i18n.PotentialCustManagerView.contactTel'),colspan:3,name:'contacterPhone',regexText:i18n('i18n.ScatterCustManagerView.message_rightString'),regex:DpUtil.linkWayLimit('T')},{fieldLabel:i18n('i18n.PotentialCustManagerView.coopIntention'),colspan:3,xtype:'combo',name:'coopIntention',store:me.scatterCust.getCoopertationIntensionStore(),queryMode:'local',forceSelection:true,displayField:'codeDesc',valueField:'code'},{fieldLabel:i18n('i18n.ScatterCustManagerView.custAttribute'),xtype:'combo',colspan:3,name:'custNature',store:me.scatterCust.getCustPropertyStore(),queryMode:'local',forceSelection:true,displayField:'codeDesc',valueField:'code'},{fieldLabel:i18n('i18n.PotentialCustManagerView.position'),colspan:3,name:'position'},{fieldLabel:i18n('i18n.PotentialCustManagerView.industry'),colspan:3,xtype:'combo',name:'industry',store:me.scatterCust.getIndustryStore(),queryMode:'local',forceSelection:true,displayField:'codeDesc',valueField:'code'},{fieldLabel:i18n('i18n.PotentialCustManagerView.goodsPotential'),colspan:3,name:'volumePotential',xtype:'combobox',store:me.scatterCust.getGoodsPotentialStore(),queryMode:'local',forceSelection:true,displayField:'codeDesc',valueField:'code'},{fieldLabel:i18n('i18n.PotentialCustManagerView.bizStatus'),colspan:3,xtype:'combo',name:'businessStatus',store:me.scatterCust.getBusinessOpportunityStore(),queryMode:'local',forceSelection:true,displayField:'codeDesc',valueField:'code'},{xtype:'fieldcontainer',colspan:6,border:0,width:400,layout:'column',defaultType:'datefield',defaults:{enableKeyEvents:true,listeners:{scope:me,keypress:me.keypressEvent}},items:[{fieldLabel:i18n('i18n.PotentialCustManagerView.searchStartTime'),labelWidth:65,width:200,xtype:'datefield',format:'Y-m-d',name:'beginTime',maxValue:new Date()},{xtype:'displayfield',width:10,value:i18n('i18n.PotentialCustManagerView.searchEndTime')},{xtype:'datefield',width:130,format:'Y-m-d',name:'overTime',maxValue:new Date()}]},{xtype:'fieldcontainer',colspan:3,border:0,layout:'column',defaultType:'numberfield',defaults:{hideTrigger:true,mouseWheelEnabled:false,minValue:0,enableKeyEvents:true,listeners:{scope:me,keypress:me.keypressEvent}},items:[{fieldLabel:i18n('i18n.ScatterCustManagerView.beginShipWeight'),labelWidth:65,width:120,name:'beginShipWeight',regexText:i18n('i18n.ManualRewardIntegralEditView.m_maxLength',10),regex:/^\d{0,10}$/},{xtype:'displayfield',width:10,value:i18n('i18n.PotentialCustManagerView.searchEndTime')},{fieldLabel:i18n('i18n.PotentialCustManagerView.searchEndTime'),name:'overShipWeight',hideLabel:true,width:65,labelWidth:10,regexText:i18n('i18n.ManualRewardIntegralEditView.m_maxLength',10),regex:/^\d{0,10}$/}]},{xtype:'fieldcontainer',colspan:3,border:0,layout:'column',defaultType:'numberfield',defaults:{hideTrigger:true,mouseWheelEnabled:false,minValue:0,enableKeyEvents:true,listeners:{scope:me,keypress:me.keypressEvent}},items:[{fieldLabel:i18n('i18n.ScatterCustManagerView.beginShipVotes'),name:'beginShipVotes',labelWidth:65,width:120,regexText:i18n('i18n.ScatterCustManagerView.message_rightString'),regex:/^\d{0,10}$/},{xtype:'displayfield',width:10,value:i18n('i18n.PotentialCustManagerView.searchEndTime')},{fieldLabel:i18n('i18n.PotentialCustManagerView.searchEndTime'),name:'overShipVotes',hideLabel:true,width:65,labelWidth:10,regex:/^\d{0,10}$/,regexText:i18n('i18n.ScatterCustManagerView.message_rightString')}]},{xtype:'fieldcontainer',colspan:6,border:0,layout:'column',defaultType:'numberfield',defaults:{hideTrigger:true,mouseWheelEnabled:false,minValue:0,enableKeyEvents:true,listeners:{scope:me,keypress:me.keypressEvent}},items:[{fieldLabel:i18n('i18n.ScatterCustManagerView.beginShipAmount'),name:'beginShipAmount',labelWidth:65,width:120,regexText:i18n('i18n.ManualRewardIntegralEditView.m_maxLength',10),regex:/^\d{0,10}$/},{xtype:'displayfield',width:10,value:i18n('i18n.PotentialCustManagerView.searchEndTime')},{fieldLabel:i18n('i18n.PotentialCustManagerView.searchEndTime'),name:'overShipAmount',hideLabel:true,width:65,labelWidth:10,regexText:i18n('i18n.ManualRewardIntegralEditView.m_maxLength',10),regex:/^\d{0,10}$/}]},{xtype:'fieldcontainer',colspan:3,border:0,layout:'column',defaultType:'numberfield',defaults:{hideTrigger:true,mouseWheelEnabled:false,minValue:0,enableKeyEvents:true,listeners:{scope:me,keypress:me.keypressEvent}},items:[{fieldLabel:i18n('i18n.ScatterCustManagerView.beginArrivalWeight'),name:'beginArrivalWeight',labelWidth:65,width:120,regexText:i18n('i18n.ManualRewardIntegralEditView.m_maxLength',10),regex:/^\d{0,10}$/},{xtype:'displayfield',width:10,value:i18n('i18n.PotentialCustManagerView.searchEndTime')},{fieldLabel:i18n('i18n.PotentialCustManagerView.searchEndTime'),name:'overArrivalWeight',hideLabel:true,width:65,labelWidth:10,regexText:i18n('i18n.ManualRewardIntegralEditView.m_maxLength',10),regex:/^\d{0,10}$/}]},{xtype:'fieldcontainer',colspan:3,border:0,layout:'column',defaultType:'numberfield',defaults:{hideTrigger:true,mouseWheelEnabled:false,minValue:0,enableKeyEvents:true,listeners:{scope:me,keypress:me.keypressEvent}},items:[{fieldLabel:i18n('i18n.ScatterCustManagerView.beginArrivalVotes'),name:'beginArrivalVotes',labelWidth:65,width:120,regexText:i18n('i18n.ScatterCustManagerView.message_rightString'),regex:/^\d{0,10}$/},{xtype:'displayfield',width:10,value:i18n('i18n.PotentialCustManagerView.searchEndTime')},{fieldLabel:i18n('i18n.PotentialCustManagerView.searchEndTime'),name:'overArrivalVotes',hideLabel:true,width:65,labelWidth:10,regexText:i18n('i18n.ScatterCustManagerView.message_rightString'),regex:/^\d{0,10}$/}]},{xtype:'fieldcontainer',colspan:6,border:0,layout:'column',defaultType:'numberfield',defaults:{hideTrigger:true,mouseWheelEnabled:false,minValue:0,enableKeyEvents:true,listeners:{scope:me,keypress:me.keypressEvent}},items:[{fieldLabel:i18n('i18n.ScatterCustManagerView.beginArrivalAmount'),name:'beginArrivalAmount',labelWidth:65,width:120,regexText:i18n('i18n.ManualRewardIntegralEditView.m_maxLength',10),regex:/^\d{0,10}$/},{xtype:'displayfield',width:10,value:i18n('i18n.PotentialCustManagerView.searchEndTime')},{fieldLabel:i18n('i18n.PotentialCustManagerView.searchEndTime'),name:'overArrivalAmount',hideLabel:true,width:65,labelWidth:10,regexText:i18n('i18n.ManualRewardIntegralEditView.m_maxLength',10),regex:/^\d{0,10}$/}]}];},getDefaultsContainer:function(){var me=this;return{labelWidth:65,width:195,enableKeyEvents:true,listeners:{scope:me,keypress:me.keypressEvent,change:me.changeEvent}};},keypressEvent:function(field,event){var me=this;if(event.getKey()==Ext.EventObject.ENTER){me.searchScatterCustomerList();}},changeEvent:function(field,newValue){var me=this;if('combobox'==field.getXType()&&Ext.isEmpty(newValue)){field.setValue(null);}},checkDataOpposite:function(objPre,objNext){if((DpUtil.isEmpty(objPre.getValue())&&DpUtil.isEmpty(objNext.getValue()))){return true;}
if(!DpUtil.isEmpty(objPre.getValue())&&!DpUtil.isEmpty(objNext.getValue())){if(objPre.getValue()<=objNext.getValue()){if((objNext.getValue().getTime()-objPre.getValue().getTime())<=1000*3600*24*90){return true;}}}
return false;},checkNumberOpposite:function(objPre,objNext){var success=true;var message=i18n('i18n.ScatterCustManagerView.message_checkNumberZ');if(!DpUtil.isEmpty(objNext.getValue())&&objNext.getValue()<=0){success=false;message=i18n('i18n.ScatterCustManagerView.message_checkNumberO');}else if(!DpUtil.isEmpty(objPre.getValue())&&!DpUtil.isEmpty(objNext.getValue())){if(objPre.getValue()>objNext.getValue()||objNext.getValue()<=0){success=false;message=i18n('i18n.ScatterCustManagerView.message_checkNumberO');}}
return{success:success,message:message};},searchScatterCustomerList:function(){var me=this;if(!me.validateCondition()){MessageUtil.showErrorMes(i18n('i18n.PotentialCustManagerView.message_notNull'));return;}
var checkDataInOneYearResult=DpUtil.checkDataInOneYear(me.getForm().findField('beginTime'),me.getForm().findField('overTime'));if(!checkDataInOneYearResult.success){MessageUtil.showMessage(checkDataInOneYearResult.message);return;}
var shipWeight=me.checkNumberOpposite(me.getForm().findField("beginShipWeight"),me.getForm().findField("overShipWeight"));if(!shipWeight.success){MessageUtil.showMessage(shipWeight.message);return;}
var shipVotes=me.checkNumberOpposite(me.getForm().findField("beginShipVotes"),me.getForm().findField("overShipVotes"));if(!shipVotes.success){MessageUtil.showMessage(shipVotes.message);return;}
var shipAmount=me.checkNumberOpposite(me.getForm().findField("beginShipAmount"),me.getForm().findField("overShipAmount"));if(!shipAmount.success){MessageUtil.showMessage(shipAmount.message);return;}
var arrivalWeight=me.checkNumberOpposite(me.getForm().findField("beginArrivalWeight"),me.getForm().findField("overArrivalWeight"));if(!arrivalWeight.success){MessageUtil.showMessage(arrivalWeight.message);return;}
if(!(me.checkNumberOpposite(me.getForm().findField("beginArrivalVotes"),me.getForm().findField("overArrivalVotes")))){MessageUtil.showErrorMes(i18n('i18n.PotentialCustManagerView.message_warn'));return;}
var arrivalAmount=me.checkNumberOpposite(me.getForm().findField("beginArrivalAmount"),me.getForm().findField("overArrivalAmount"));if(!arrivalAmount.success){MessageUtil.showMessage(arrivalAmount.message);return;}
if(!me.getForm().isValid()){MessageUtil.showMessage(i18n('i18n.PotentialCustManagerView.message_warn'));return;}
me.scatterCust.getScatterCustStore().loadPage(1);},validateCondition:function(){var me=this;var flag=false;me.getForm().getFields().each(function(field){if(!(DpUtil.isEmpty(field.getValue()))&&field.getValue()!=i18n('i18n.PotentialCustManagerView.searchEndTime')){flag=true;}});return flag;}});Ext.define('SearchResultGrid',{extend:'BasicPanel',scatterCust:null,store:null,items:null,autoScroll:true,parent:null,initComponent:function(){var me=this;me.store=me.scatterCust.initialScatterCustStore(me.beforeLoadScatterFn);me.items=me.getItems();this.callParent();},getItems:function(){var me=this;return[{xtype:'searchgridpanel',id:'searchScatterCustResultGrid',store:me.store,autoScroll:true,selModel:Ext.create('Ext.selection.CheckboxModel'),columns:[Ext.create('Ext.grid.RowNumberer'),{header:'id',dataIndex:'id',hidden:true},{header:i18n('i18n.PotentialCustManagerView.coopIntention'),dataIndex:'coopIntention',renderer:function(value){return DpUtil.changeDictionaryCodeToDescrip(value,DataDictionary.COOPERATION_INTENTION);}},{header:i18n('i18n.PotentialCustManagerView.customerName'),dataIndex:'custName'},{header:i18n('i18n.PotentialCustManagerView.contactName'),dataIndex:'linkManName'},{header:i18n('i18n.PotentialCustManagerView.contactPhone'),dataIndex:'linkManMobile'},{header:i18n('i18n.PotentialCustManagerView.contactTel'),dataIndex:'linkManPhone'},{header:i18n('i18n.PotentialCustManagerView.position'),dataIndex:'post'},{header:i18n('i18n.PotentialCustManagerView.goodsPotential'),dataIndex:'volumePotential',renderer:function(value){return DpUtil.changeDictionaryCodeToDescrip(value,DataDictionary.CARGO_POTENTIAL);}},{header:i18n('i18n.PotentialCustManagerView.bizStatus'),dataIndex:'bussinesState',renderer:function(value){return DpUtil.changeDictionaryCodeToDescrip(value,DataDictionary.BUSINESS_STATUS);}},{header:i18n('i18n.PotentialCustManagerView.industry'),dataIndex:'trade',renderer:function(value){return DpUtil.changeDictionaryCodeToDescrip(value,DataDictionary.TRADE);}},{header:i18n('i18n.PotentialCustManagerView.developState'),dataIndex:'developState',hidden:true,renderer:function(value){return DpUtil.changeDictionaryCodeToDescrip(value,DataDictionary.DEVELOP_STATUS);}},{header:i18n('i18n.PotentialCustManagerView.finalreviTime'),dataIndex:'finalreviTime',hidden:true,renderer:function(value){return DpUtil.renderDate(value);}},{header:i18n('i18n.PotentialCustManagerView.reviTimes'),dataIndex:'reviTimes',hidden:true,renderer:function(value){}},{header:i18n('i18n.PotentialCustManagerView.programmeTime'),dataIndex:'programmeTime',hidden:true,renderer:function(value){return DpUtil.renderDate(value);}},{header:i18n('i18n.PotentialCustManagerView.creator'),dataIndex:'createUser'},{header:i18n('i18n.PotentialCustManagerView.createTime'),dataIndex:'createDate',renderer:function(value){return DpUtil.renderDate(value);}},{header:i18n('i18n.PotentialCustManagerView.lastUpdate'),dataIndex:'modifyUser'},{header:i18n('i18n.PotentialCustManagerView.lastUpdateTime'),dataIndex:'modifyDate',renderer:function(value){return DpUtil.renderDate(value);}}],dockedItems:[{xtype:'pagingtoolbar',store:me.store,dock:'bottom',displayInfo:true}],listeners:{scope:me,itemdblclick:me.lookScatterCustDetail}}];},updateScatterCust:function(){var me=this;var grid=Ext.getCmp('searchScatterCustResultGrid');selection=grid.getSelectionModel().getSelection();if(selection.length!=1){MessageUtil.showMessage(i18n('i18n.PotentialCustManagerView.operation_message'));}else{var editScatterWin=Ext.create('ScatterCustEditWindow',{'viewStatus':'update','scatterCustRecord':selection[0],'scatterCustManagerView':me.parent});editScatterWin.show();}},delScatterCust:function(){var me=this;var grid=Ext.getCmp('searchScatterCustResultGrid');selection=grid.getSelectionModel().getSelection();if(selection.length==0){MessageUtil.showMessage(i18n('i18n.PotentialCustManagerView.operation_messages'));return;}
MessageUtil.showQuestionMes(i18n('i18n.PotentialCustManagerView.confirm_message'),function(e){if(e=='yes'){var scatterCustIds=new Array();for(var j=0;j<selection.length;j++){scatterCustIds.push(selection[j].get('id'))}
var delSuccess=function(response){var form=Ext.getCmp('searchScatterCustConditionForm');MessageUtil.showInfoMes(i18n('i18n.PotentialCustManagerView.deleteSuccess'));me.scatterCust.getScatterCustStore().loadPage(1);};var delFail=function(response){MessageUtil.showErrorMes(response.message);};var params={};params.scatterCustIds=scatterCustIds;me.scatterCust.deleteScatterCustomer(params,delSuccess,delFail);}});},lookScatterCustDetail:function(grid,record){var me=this;selection=grid.getSelectionModel().getSelection();if(selection.length!=1){MessageUtil.showMessage(i18n('i18n.PotentialCustManagerView.operation_message'));return;}
Ext.create('ScatterCustDetailWindow',{'scatterCustRecord':record}).show();},addNewVisit:function(grid,record){var me=this;var grid=Ext.getCmp('searchScatterCustResultGrid');selection=grid.getSelectionModel().getSelection();if(selection.length!=1){MessageUtil.showMessage(i18n('i18n.PotentialCustManagerView.operation_message'));return;}},beforeLoadScatterFn:function(store,operation,eOpts){var searchScatterForm=Ext.getCmp("searchScatterCustConditionForm");if(searchScatterForm!=null){searchScatterForm.getForm().updateRecord(searchScatterForm.record);var searchCustomerCondition=searchScatterForm.record.data;var searchParams={'scatterCustomerCondition.custName':searchCustomerCondition.custName,'scatterCustomerCondition.industry':searchCustomerCondition.industry,'scatterCustomerCondition.coopIntention':searchCustomerCondition.coopIntention,'scatterCustomerCondition.custAttribute':searchCustomerCondition.custAttribute,'scatterCustomerCondition.contacterName':searchCustomerCondition.contacterName,'scatterCustomerCondition.contacterMobile':searchCustomerCondition.contacterMobile,'scatterCustomerCondition.contacterPhone':searchCustomerCondition.contacterPhone,'scatterCustomerCondition.position':searchCustomerCondition.position,'scatterCustomerCondition.volumePotential':searchCustomerCondition.volumePotential,'scatterCustomerCondition.beginTime':searchCustomerCondition.beginTime,'scatterCustomerCondition.overTime':searchCustomerCondition.overTime,'scatterCustomerCondition.businessStatus':searchCustomerCondition.businessStatus,'scatterCustomerCondition.beginShipWeight':searchCustomerCondition.beginShipWeight,'scatterCustomerCondition.overShipWeight':searchCustomerCondition.overShipWeight,'scatterCustomerCondition.beginShipVotes':searchCustomerCondition.beginShipVotes,'scatterCustomerCondition.overShipVotes':searchCustomerCondition.overShipVotes,'scatterCustomerCondition.beginShipAmount':searchCustomerCondition.beginShipAmount,'scatterCustomerCondition.overShipAmount':searchCustomerCondition.overShipAmount,'scatterCustomerCondition.beginArrivalWeight':searchCustomerCondition.beginArrivalWeight,'scatterCustomerCondition.overArrivalWeight':searchCustomerCondition.overArrivalWeight,'scatterCustomerCondition.beginArrivalVotes':searchCustomerCondition.beginArrivalVotes,'scatterCustomerCondition.overArrivalVotes':searchCustomerCondition.overArrivalVotes,'scatterCustomerCondition.beginArrivalAmount':searchCustomerCondition.beginArrivalAmount,'scatterCustomerCondition.overArrivalAmount':searchCustomerCondition.overArrivalAmount};Ext.apply(operation,{params:searchParams});}}});Ext.onReady(function(){Ext.create('Ext.Viewport',{layout:{type:'fit'},items:[Ext.create('ScatterCustManagerPanel',{'scatterCust':scatterCustDataControl})]});});